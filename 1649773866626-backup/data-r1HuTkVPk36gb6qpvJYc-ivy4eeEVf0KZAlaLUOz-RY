Ly8gc3JjL3V0aWxzLnRzCnZhciBpc0FkZHJlc3MgPSAoYWRkcikgPT4gewogIGlmICghYWRkcikKICAgIHJldHVybiBmYWxzZTsKICBpZiAodHlwZW9mIGFkZHIgIT09ICJzdHJpbmciKQogICAgcmV0dXJuIGZhbHNlOwogIHJldHVybiAhIS9eW2EtejAtOV8tXXs0M30kL2kudGVzdChhZGRyKTsKfTsKdmFyIFJFU1RSSUNUX1RPX0lOVEVHRVIgPSB0cnVlOwoKLy8gc3JjL21vZHVsZXMvdHJhbnNmZXIudHMKZnVuY3Rpb24gVHJhbnNmZXIoc3RhdGUsIGFjdGlvbikgewogIGNvbnN0IGlucHV0ID0gYWN0aW9uLmlucHV0OwogIGNvbnN0IHRhcmdldCA9IGlucHV0LnRhcmdldDsKICBDb250cmFjdEFzc2VydCghIXRhcmdldCwgIk5vIHRhcmdldCBzcGVjaWZpZWQiKTsKICBDb250cmFjdEFzc2VydChpc0FkZHJlc3ModGFyZ2V0KSwgYFRoZSBnaXZlbiB0YXJnZXQgaXMgbm90IGEgdmFsaWQgQXJ3ZWF2ZSBhZGRyZXNzOiAke2lucHV0LnRhcmdldH1gKTsKICBjb25zdCBjYWxsZXIgPSBhY3Rpb24uY2FsbGVyOwogIENvbnRyYWN0QXNzZXJ0KGNhbGxlciAhPT0gdGFyZ2V0LCAiVXNlciBjYW5ub3QgdHJhbnNmZXIgdG8gdGhlbXNlbHZlcyIpOwogIGNvbnN0IHF0eSA9IGlucHV0LnF0eTsKICBDb250cmFjdEFzc2VydChOdW1iZXIuaXNJbnRlZ2VyKHF0eSkgfHwgIVJFU1RSSUNUX1RPX0lOVEVHRVIsICdJbnZhbGlkIHZhbHVlIGZvciAicXR5Ii4gTXVzdCBiZSBhbiBpbnRlZ2VyJyk7CiAgQ29udHJhY3RBc3NlcnQocXR5ID4gMCwgIlRyYW5zZmVyIHF0eSBpcyB0b28gbG93Iik7CiAgY29uc3QgYmFsYW5jZXMgPSBzdGF0ZS5iYWxhbmNlczsKICBDb250cmFjdEFzc2VydChjYWxsZXIgaW4gYmFsYW5jZXMsICJDYWxsZXIgZG9lc24ndCBvd24gYW55IERBTyBiYWxhbmNlIik7CiAgQ29udHJhY3RBc3NlcnQoYmFsYW5jZXNbY2FsbGVyXSA-PSBxdHksIGBDYWxsZXIgYmFsYW5jZSBub3QgaGlnaCBlbm91Z2ggdG8gc2VuZCAke3F0eX0gdG9rZW4ocylgKTsKICBiYWxhbmNlc1tjYWxsZXJdIC09IHF0eTsKICBpZiAodGFyZ2V0IGluIGJhbGFuY2VzKSB7CiAgICBiYWxhbmNlc1t0YXJnZXRdICs9IHF0eTsKICB9IGVsc2UgewogICAgYmFsYW5jZXNbdGFyZ2V0XSA9IHF0eTsKICB9CiAgcmV0dXJuIHN0YXRlOwp9CgovLyBzcmMvbW9kdWxlcy90cmFuc2ZlckxvY2tlZC50cwpmdW5jdGlvbiBUcmFuc2ZlckxvY2tlZChzdGF0ZSwgYWN0aW9uKSB7CiAgY29uc3QgaW5wdXQgPSBhY3Rpb24uaW5wdXQ7CiAgY29uc3QgY2FsbGVyID0gYWN0aW9uLmNhbGxlcjsKICBjb25zdCB0YXJnZXQgPSBpbnB1dC50YXJnZXQ7CiAgQ29udHJhY3RBc3NlcnQoISF0YXJnZXQsICJObyB0YXJnZXQgc3BlY2lmaWVkIik7CiAgQ29udHJhY3RBc3NlcnQoaXNBZGRyZXNzKHRhcmdldCksIGBUaGUgZ2l2ZW4gdGFyZ2V0IGlzIG5vdCBhIHZhbGlkIEFyd2VhdmUgYWRkcmVzczogJHtpbnB1dC50YXJnZXR9YCk7CiAgY29uc3QgcXR5ID0gK2lucHV0LnF0eTsKICBDb250cmFjdEFzc2VydChOdW1iZXIuaXNJbnRlZ2VyKHF0eSkgfHwgIVJFU1RSSUNUX1RPX0lOVEVHRVIsICdJbnZhbGlkIHZhbHVlIGZvciAicXR5Ii4gTXVzdCBiZSBhbiBpbnRlZ2VyJyk7CiAgQ29udHJhY3RBc3NlcnQocXR5ID4gMCwgIlRyYW5zZmVyIHF0eSBpcyB0b28gbG93Iik7CiAgY29uc3QgbG9ja0xlbmd0aCA9ICtpbnB1dC5sb2NrTGVuZ3RoOwogIGNvbnN0IHNldHRpbmdzID0gbmV3IE1hcChzdGF0ZS5zZXR0aW5ncyk7CiAgQ29udHJhY3RBc3NlcnQoTnVtYmVyLmlzSW50ZWdlcihsb2NrTGVuZ3RoKSwgJ0ludmFsaWQgdmFsdWUgZm9yICJsb2NrTGVuZ3RoIi4gTXVzdCBiZSBhbiBpbnRlZ2VyJyk7CiAgQ29udHJhY3RBc3NlcnQobG9ja0xlbmd0aCA-IHNldHRpbmdzLmdldCgibG9ja01pbkxlbmd0aCIpICYmIGxvY2tMZW5ndGggPCBzZXR0aW5ncy5nZXQoImxvY2tNYXhMZW5ndGgiKSwgYElucHV0IGZvciAibG9ja0xlbmd0aCIgaXMgb3V0IG9mIHJhbmdlLCBtdXN0IGJlIGJldHdlZW4gJHtzZXR0aW5ncy5nZXQoImxvY2tNaW5MZW5ndGgiKX0gYW5kICR7c2V0dGluZ3MuZ2V0KCJsb2NrTWF4TGVuZ3RoIil9YCk7CiAgY29uc3QgYmFsYW5jZXMgPSBzdGF0ZS5iYWxhbmNlczsKICBjb25zdCBiYWxhbmNlID0gYmFsYW5jZXNbY2FsbGVyXTsKICBDb250cmFjdEFzc2VydCghaXNOYU4oYmFsYW5jZSkgJiYgYmFsYW5jZSA-PSBxdHksICJOb3QgZW5vdWdoIGJhbGFuY2UiKTsKICBiYWxhbmNlc1tjYWxsZXJdIC09IHF0eTsKICBjb25zdCBzdGFydCA9ICtTbWFydFdlYXZlLmJsb2NrLmhlaWdodDsKICBjb25zdCBlbmQgPSBzdGFydCArIGxvY2tMZW5ndGg7CiAgY29uc3QgdmF1bHQgPSBzdGF0ZS52YXVsdDsKICBpZiAodGFyZ2V0IGluIHZhdWx0KSB7CiAgICB2YXVsdFt0YXJnZXRdLnB1c2goewogICAgICBiYWxhbmNlOiBxdHksCiAgICAgIGVuZCwKICAgICAgc3RhcnQKICAgIH0pOwogIH0gZWxzZSB7CiAgICB2YXVsdFt0YXJnZXRdID0gWwogICAgICB7CiAgICAgICAgYmFsYW5jZTogcXR5LAogICAgICAgIGVuZCwKICAgICAgICBzdGFydAogICAgICB9CiAgICBdOwogIH0KICByZXR1cm4gc3RhdGU7Cn0KCi8vIHNyYy9tb2R1bGVzL2JhbGFuY2UudHMKZnVuY3Rpb24gQmFsYW5jZShzdGF0ZSwgYWN0aW9uKSB7CiAgY29uc3QgY2FsbGVyID0gYWN0aW9uLmNhbGxlcjsKICBjb25zdCBpbnB1dCA9IGFjdGlvbi5pbnB1dDsKICBjb25zdCB0YXJnZXQgPSBpbnB1dC50YXJnZXQgfHwgY2FsbGVyOwogIENvbnRyYWN0QXNzZXJ0KC9bYS16MC05Xy1dezQzfS9pLnRlc3QodGFyZ2V0KSwgIkNhbGxlciBkaWQgbm90IHN1cHBseSBhIHZhbGlkIHRhcmdldC4iKTsKICBjb25zdCBiYWxhbmNlcyA9IHN0YXRlLmJhbGFuY2VzOwogIGNvbnN0IHZhdWx0ID0gc3RhdGUudmF1bHQ7CiAgbGV0IGJhbGFuY2UgPSAwOwogIGlmICh0YXJnZXQgaW4gYmFsYW5jZXMpIHsKICAgIGJhbGFuY2UgPSBiYWxhbmNlc1t0YXJnZXRdOwogIH0KICBpZiAodGFyZ2V0IGluIHZhdWx0ICYmIHZhdWx0W3RhcmdldF0ubGVuZ3RoKSB7CiAgICB0cnkgewogICAgICBiYWxhbmNlICs9IHZhdWx0W3RhcmdldF0ubWFwKChhKSA9PiBhLmJhbGFuY2UpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApOwogICAgfSBjYXRjaCAoZSkgewogICAgfQogIH0KICByZXR1cm4geyB0YXJnZXQsIGJhbGFuY2UgfTsKfQoKLy8gc3JjL21vZHVsZXMvdW5sb2NrZWRCYWxhbmNlLnRzCmZ1bmN0aW9uIFVubG9ja2VkQmFsYW5jZShzdGF0ZSwgYWN0aW9uKSB7CiAgY29uc3QgY2FsbGVyID0gYWN0aW9uLmNhbGxlcjsKICBjb25zdCBpbnB1dCA9IGFjdGlvbi5pbnB1dDsKICBjb25zdCB0YXJnZXQgPSBpbnB1dC50YXJnZXQgfHwgY2FsbGVyOwogIENvbnRyYWN0QXNzZXJ0KC9bYS16MC05Xy1dezQzfS9pLnRlc3QodGFyZ2V0KSwgIkNhbGxlciBkaWQgbm90IHN1cHBseSBhIHZhbGlkIHRhcmdldC4iKTsKICBjb25zdCBiYWxhbmNlcyA9IHN0YXRlLmJhbGFuY2VzOwogIGxldCBiYWxhbmNlID0gMDsKICBpZiAodGFyZ2V0IGluIGJhbGFuY2VzKSB7CiAgICBiYWxhbmNlID0gYmFsYW5jZXNbdGFyZ2V0XTsKICB9CiAgcmV0dXJuIHsgdGFyZ2V0LCBiYWxhbmNlIH07Cn0KCi8vIHNyYy9tb2R1bGVzL2xvY2sudHMKZnVuY3Rpb24gTG9jayhzdGF0ZSwgYWN0aW9uKSB7CiAgY29uc3QgaW5wdXQgPSBhY3Rpb24uaW5wdXQ7CiAgY29uc3QgY2FsbGVyID0gYWN0aW9uLmNhbGxlcjsKICBjb25zdCBxdHkgPSAraW5wdXQucXR5OwogIENvbnRyYWN0QXNzZXJ0KE51bWJlci5pc0ludGVnZXIocXR5KSB8fCAhUkVTVFJJQ1RfVE9fSU5URUdFUiwgJ0ludmFsaWQgdmFsdWUgZm9yICJxdHkiLiBNdXN0IGJlIGFuIGludGVnZXInKTsKICBDb250cmFjdEFzc2VydChxdHkgPiAwLCAiTG9jayBxdHkgaXMgdG9vIGxvdyIpOwogIGNvbnN0IGxvY2tMZW5ndGggPSAraW5wdXQubG9ja0xlbmd0aDsKICBjb25zdCBzZXR0aW5ncyA9IG5ldyBNYXAoc3RhdGUuc2V0dGluZ3MpOwogIENvbnRyYWN0QXNzZXJ0KE51bWJlci5pc0ludGVnZXIobG9ja0xlbmd0aCksICdJbnZhbGlkIHZhbHVlIGZvciAibG9ja0xlbmd0aCIuIE11c3QgYmUgYW4gaW50ZWdlcicpOwogIENvbnRyYWN0QXNzZXJ0KGxvY2tMZW5ndGggPiBzZXR0aW5ncy5nZXQoImxvY2tNaW5MZW5ndGgiKSAmJiBsb2NrTGVuZ3RoIDwgc2V0dGluZ3MuZ2V0KCJsb2NrTWF4TGVuZ3RoIiksIGBJbnB1dCBmb3IgImxvY2tMZW5ndGgiIGlzIG91dCBvZiByYW5nZSwgbXVzdCBiZSBiZXR3ZWVuICR7c2V0dGluZ3MuZ2V0KCJsb2NrTWluTGVuZ3RoIil9IGFuZCAke3NldHRpbmdzLmdldCgibG9ja01heExlbmd0aCIpfWApOwogIGNvbnN0IGJhbGFuY2VzID0gc3RhdGUuYmFsYW5jZXM7CiAgY29uc3QgYmFsYW5jZSA9IGJhbGFuY2VzW2NhbGxlcl07CiAgQ29udHJhY3RBc3NlcnQoIWlzTmFOKGJhbGFuY2UpICYmIGJhbGFuY2UgPj0gcXR5LCAiTm90IGVub3VnaCBiYWxhbmNlIik7CiAgYmFsYW5jZXNbY2FsbGVyXSAtPSBxdHk7CiAgY29uc3Qgc3RhcnQgPSArU21hcnRXZWF2ZS5ibG9jay5oZWlnaHQ7CiAgY29uc3QgZW5kID0gc3RhcnQgKyBsb2NrTGVuZ3RoOwogIGNvbnN0IHZhdWx0ID0gc3RhdGUudmF1bHQ7CiAgaWYgKGNhbGxlciBpbiB2YXVsdCkgewogICAgdmF1bHRbY2FsbGVyXS5wdXNoKHsKICAgICAgYmFsYW5jZTogcXR5LAogICAgICBlbmQsCiAgICAgIHN0YXJ0CiAgICB9KTsKICB9IGVsc2UgewogICAgdmF1bHRbY2FsbGVyXSA9IFsKICAgICAgewogICAgICAgIGJhbGFuY2U6IHF0eSwKICAgICAgICBlbmQsCiAgICAgICAgc3RhcnQKICAgICAgfQogICAgXTsKICB9CiAgcmV0dXJuIHN0YXRlOwp9CgovLyBzcmMvbW9kdWxlcy9yZWFkT3V0Ym94LnRzCmFzeW5jIGZ1bmN0aW9uIFJlYWRPdXRib3goc3RhdGUsIGFjdGlvbikgewogIGNvbnN0IGlucHV0ID0gYWN0aW9uLmlucHV0OwogIENvbnRyYWN0QXNzZXJ0KCEhaW5wdXQuY29udHJhY3QsICJNaXNzaW5nIGNvbnRyYWN0IHRvIGludm9rZSIpOwogIGNvbnN0IGZvcmVpZ25TdGF0ZSA9IGF3YWl0IFNtYXJ0V2VhdmUuY29udHJhY3RzLnJlYWRDb250cmFjdFN0YXRlKGlucHV0LmNvbnRyYWN0KTsKICBDb250cmFjdEFzc2VydCghIWZvcmVpZ25TdGF0ZS5mb3JlaWduQ2FsbHMsICJDb250cmFjdCBpcyBtaXNzaW5nIHN1cHBvcnQgZm9yIGZvcmVpZ24gY2FsbHMiKTsKICBjb25zdCBjYWxscyA9IGZvcmVpZ25TdGF0ZS5mb3JlaWduQ2FsbHMuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50LmNvbnRyYWN0ID09PSBTbWFydFdlYXZlLmNvbnRyYWN0LmlkICYmICFzdGF0ZS5pbnZvY2F0aW9ucy5pbmNsdWRlcyhlbGVtZW50LnR4SUQpKTsKICBsZXQgcmVzID0gc3RhdGU7CiAgZm9yIChjb25zdCBlbnRyeSBvZiBjYWxscykgewogICAgY29uc3QgaW52b2tlZFJlcyA9IGF3YWl0IGhhbmRsZShyZXMsIHsKICAgICAgY2FsbGVyOiBpbnB1dC5jb250cmFjdCwKICAgICAgaW5wdXQ6IGVudHJ5LmlucHV0CiAgICB9KTsKICAgIGlmICghaW52b2tlZFJlcy5zdGF0ZSkKICAgICAgY29udGludWU7CiAgICByZXMgPSBpbnZva2VkUmVzLnN0YXRlOwogICAgcmVzLmludm9jYXRpb25zLnB1c2goZW50cnkudHhJRCk7CiAgfQogIHJldHVybiByZXM7Cn0KCi8vIHNyYy9tb2R1bGVzL2ludm9rZS50cwphc3luYyBmdW5jdGlvbiBJbnZva2Uoc3RhdGUsIGFjdGlvbikgewogIGNvbnN0IGlucHV0ID0gYWN0aW9uLmlucHV0OwogIENvbnRyYWN0QXNzZXJ0KCEhaW5wdXQuaW52b2NhdGlvbiwgIk1pc3NpbmcgZnVuY3Rpb24gaW52b2NhdGlvbiIpOwogIENvbnRyYWN0QXNzZXJ0KCEhaW5wdXQuZm9yZWlnbkNvbnRyYWN0LCAiTWlzc2luZyBmb3JlaWduIGNvbnRyYWN0IElEIik7CiAgc3RhdGUuZm9yZWlnbkNhbGxzLnB1c2goewogICAgdHhJRDogU21hcnRXZWF2ZS50cmFuc2FjdGlvbi5pZCwKICAgIGNvbnRyYWN0OiBpbnB1dC5mb3JlaWduQ29udHJhY3QsCiAgICBpbnB1dDogaW5wdXQuaW52b2NhdGlvbgogIH0pOwogIHJldHVybiBzdGF0ZTsKfQoKLy8gc3JjL21vZHVsZXMvaW5jcmVhc2VWYXVsdC50cwpmdW5jdGlvbiBJbmNyZWFzZVZhdWx0KHN0YXRlLCBhY3Rpb24pIHsKICBjb25zdCBpbnB1dCA9IGFjdGlvbi5pbnB1dDsKICBjb25zdCBjYWxsZXIgPSBhY3Rpb24uY2FsbGVyOwogIGNvbnN0IGxvY2tMZW5ndGggPSBpbnB1dC5sb2NrTGVuZ3RoOwogIGNvbnN0IHNldHRpbmdzID0gbmV3IE1hcChzdGF0ZS5zZXR0aW5ncyk7CiAgQ29udHJhY3RBc3NlcnQoTnVtYmVyLmlzSW50ZWdlcihsb2NrTGVuZ3RoKSwgJ0ludmFsaWQgdmFsdWUgZm9yICJsb2NrTGVuZ3RoIi4gTXVzdCBiZSBhbiBpbnRlZ2VyJyk7CiAgQ29udHJhY3RBc3NlcnQobG9ja0xlbmd0aCA-IHNldHRpbmdzLmdldCgibG9ja01pbkxlbmd0aCIpICYmIGxvY2tMZW5ndGggPCBzZXR0aW5ncy5nZXQoImxvY2tNYXhMZW5ndGgiKSwgYElucHV0IGZvciAibG9ja0xlbmd0aCIgaXMgb3V0IG9mIHJhbmdlLCBtdXN0IGJlIGJldHdlZW4gJHtzZXR0aW5ncy5nZXQoImxvY2tNaW5MZW5ndGgiKX0gYW5kICR7c2V0dGluZ3MuZ2V0KCJsb2NrTWF4TGVuZ3RoIil9YCk7CiAgY29uc3QgaWQgPSBpbnB1dC5pZDsKICBjb25zdCB2YXVsdCA9IHN0YXRlLnZhdWx0OwogIENvbnRyYWN0QXNzZXJ0KGNhbGxlciBpbiB2YXVsdCwgIkNhbGxlciBkb2VzIG5vdCBoYXZlIGEgdmF1bHQiKTsKICBDb250cmFjdEFzc2VydCghIXZhdWx0W2NhbGxlcl1baWRdLCAiSW52YWxpZCB2YXVsdCBJRCIpOwogIENvbnRyYWN0QXNzZXJ0KCtTbWFydFdlYXZlLmJsb2NrLmhlaWdodCA8IHZhdWx0W2NhbGxlcl1baWRdLmVuZCwgIlRoaXMgdmF1bHQgaGFzIGVuZGVkIik7CiAgdmF1bHRbY2FsbGVyXVtpZF0uZW5kID0gK1NtYXJ0V2VhdmUuYmxvY2suaGVpZ2h0ICsgbG9ja0xlbmd0aDsKICByZXR1cm4gc3RhdGU7Cn0KCi8vIHNyYy9tb2R1bGVzL3VubG9jay50cwpmdW5jdGlvbiBVbmxvY2soc3RhdGUsIGFjdGlvbikgewogIGNvbnN0IGNhbGxlciA9IGFjdGlvbi5jYWxsZXI7CiAgY29uc3QgdmF1bHQgPSBzdGF0ZS52YXVsdDsKICBjb25zdCBiYWxhbmNlcyA9IHN0YXRlLmJhbGFuY2VzOwogIGlmICghKGNhbGxlciBpbiB2YXVsdCkgfHwgdmF1bHRbY2FsbGVyXS5sZW5ndGggPT09IDApCiAgICByZXR1cm4gc3RhdGU7CiAgbGV0IGkgPSB2YXVsdFtjYWxsZXJdLmxlbmd0aDsKICB3aGlsZSAoaS0tKSB7CiAgICBjb25zdCBsb2NrZWQgPSB2YXVsdFtjYWxsZXJdW2ldOwogICAgaWYgKCtTbWFydFdlYXZlLmJsb2NrLmhlaWdodCA-PSBsb2NrZWQuZW5kKSB7CiAgICAgIGlmIChjYWxsZXIgaW4gYmFsYW5jZXMgJiYgdHlwZW9mIGJhbGFuY2VzW2NhbGxlcl0gPT09ICJudW1iZXIiKSB7CiAgICAgICAgYmFsYW5jZXNbY2FsbGVyXSArPSBsb2NrZWQuYmFsYW5jZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBiYWxhbmNlc1tjYWxsZXJdID0gbG9ja2VkLmJhbGFuY2U7CiAgICAgIH0KICAgICAgdmF1bHRbY2FsbGVyXS5zcGxpY2UoaSwgMSk7CiAgICB9CiAgfQogIHJldHVybiBzdGF0ZTsKfQoKLy8gc3JjL21vZHVsZXMvdmF1bHRCYWxhbmNlLnRzCmZ1bmN0aW9uIFZhdWx0QmFsYW5jZShzdGF0ZSwgYWN0aW9uKSB7CiAgY29uc3QgY2FsbGVyID0gYWN0aW9uLmNhbGxlcjsKICBjb25zdCBpbnB1dCA9IGFjdGlvbi5pbnB1dDsKICBjb25zdCB0YXJnZXQgPSBpbnB1dC50YXJnZXQgfHwgY2FsbGVyOwogIENvbnRyYWN0QXNzZXJ0KC9bYS16MC05Xy1dezQzfS9pLnRlc3QodGFyZ2V0KSwgIkNhbGxlciBkaWQgbm90IHN1cHBseSBhIHZhbGlkIHRhcmdldC4iKTsKICBjb25zdCB2YXVsdCA9IHN0YXRlLnZhdWx0OwogIGxldCBiYWxhbmNlID0gMDsKICBpZiAodGFyZ2V0IGluIHZhdWx0KSB7CiAgICBjb25zdCBibG9ja0hlaWdodCA9ICtTbWFydFdlYXZlLmJsb2NrLmhlaWdodDsKICAgIGNvbnN0IGZpbHRlcmVkID0gdmF1bHRbdGFyZ2V0XS5maWx0ZXIoKGEpID0-IGJsb2NrSGVpZ2h0IDwgYS5lbmQpOwogICAgZm9yIChjb25zdCB2YXVsdEl0ZW0gb2YgZmlsdGVyZWQpIHsKICAgICAgYmFsYW5jZSArPSB2YXVsdEl0ZW0uYmFsYW5jZTsKICAgIH0KICB9CiAgcmV0dXJuIHsgdGFyZ2V0LCBiYWxhbmNlIH07Cn0KCi8vIHNyYy9tb2R1bGVzL3Byb3Bvc2UudHMKZnVuY3Rpb24gUHJvcG9zZShzdGF0ZSwgYWN0aW9uKSB7CiAgY29uc3QgaW5wdXQgPSBhY3Rpb24uaW5wdXQ7CiAgY29uc3QgY2FsbGVyID0gYWN0aW9uLmNhbGxlcjsKICBjb25zdCBub3RlID0gaW5wdXQubm90ZTsKICBjb25zdCBiYWxhbmNlcyA9IHN0YXRlLmJhbGFuY2VzOwogIGNvbnN0IHNldHRpbmdzID0gbmV3IE1hcChzdGF0ZS5zZXR0aW5ncyk7CiAgQ29udHJhY3RBc3NlcnQodHlwZW9mIG5vdGUgPT09ICJzdHJpbmciLCAiTm90ZSBmb3JtYXQgbm90IHJlY29nbml6ZWQiKTsKICBjb25zdCB2YXVsdCA9IHN0YXRlLnZhdWx0OwogIENvbnRyYWN0QXNzZXJ0KGNhbGxlciBpbiB2YXVsdCwgIkNhbGxlciBuZWVkcyB0byBoYXZlIGxvY2tlZCBiYWxhbmNlcy4iKTsKICBDb250cmFjdEFzc2VydCghIXZhdWx0W2NhbGxlcl0gJiYgISF2YXVsdFtjYWxsZXJdLmZpbHRlcigoYSkgPT4gYS5iYWxhbmNlID4gMCkubGVuZ3RoLCAiQ2FsbGVyIGRvZXNuJ3QgaGF2ZSBhbnkgbG9ja2VkIGJhbGFuY2UiKTsKICBsZXQgdG90YWxXZWlnaHQgPSAwOwogIGNvbnN0IHZhdWx0VmFsdWVzID0gT2JqZWN0LnZhbHVlcyh2YXVsdCk7CiAgZm9yIChjb25zdCBsb2NrZWQgb2YgdmF1bHRWYWx1ZXMpIHsKICAgIGZvciAoY29uc3QgbG9ja2VkSXRlbSBvZiBsb2NrZWQpIHsKICAgICAgdG90YWxXZWlnaHQgKz0gbG9ja2VkSXRlbS5iYWxhbmNlICogKGxvY2tlZEl0ZW0uZW5kIC0gbG9ja2VkSXRlbS5zdGFydCk7CiAgICB9CiAgfQogIGNvbnN0IHZvdGVUeXBlID0gaW5wdXQudHlwZTsKICBjb25zdCB2b3RlcyA9IHN0YXRlLnZvdGVzOwogIGxldCB2b3RlID0gewogICAgc3RhdHVzOiAiYWN0aXZlIiwKICAgIHR5cGU6IHZvdGVUeXBlLAogICAgbm90ZSwKICAgIHlheXM6IDAsCiAgICBuYXlzOiAwLAogICAgdm90ZWQ6IFtdLAogICAgc3RhcnQ6ICtTbWFydFdlYXZlLmJsb2NrLmhlaWdodCwKICAgIHRvdGFsV2VpZ2h0CiAgfTsKICBpZiAodm90ZVR5cGUgPT09ICJtaW50IiB8fCB2b3RlVHlwZSA9PT0gIm1pbnRMb2NrZWQiKSB7CiAgICBjb25zdCByZWNpcGllbnQgPSBpbnB1dC5yZWNpcGllbnQ7CiAgICBDb250cmFjdEFzc2VydChpc0FkZHJlc3MoaW5wdXQucmVjaXBpZW50KSwgIlJlY2lwaWVudCBhZGRyZXNzIGlzIGludmFsaWQiKTsKICAgIGNvbnN0IHF0eSA9ICtpbnB1dC5xdHk7CiAgICBDb250cmFjdEFzc2VydChOdW1iZXIuaXNJbnRlZ2VyKHF0eSkgfHwgIVJFU1RSSUNUX1RPX0lOVEVHRVIsICJRdHkgaXMgbm90IGEgdmFsaWQgYWRkcmVzcyIpOwogICAgQ29udHJhY3RBc3NlcnQocXR5ID4gMCwgIlF0eSBpcyBsZXNzIHRoYW4gMCIpOwogICAgbGV0IHRvdGFsU3VwcGx5ID0gMDsKICAgIGNvbnN0IHZhdWx0VmFsdWVzMiA9IE9iamVjdC52YWx1ZXModmF1bHQpOwogICAgZm9yIChjb25zdCB2YXVsdEl0ZW0gb2YgdmF1bHRWYWx1ZXMyKSB7CiAgICAgIGZvciAoY29uc3QgbG9ja2VkIG9mIHZhdWx0SXRlbSkgewogICAgICAgIHRvdGFsU3VwcGx5ICs9IGxvY2tlZC5iYWxhbmNlOwogICAgICB9CiAgICB9CiAgICBjb25zdCBiYWxhbmNlc1ZhbHVlcyA9IE9iamVjdC52YWx1ZXMoYmFsYW5jZXMpOwogICAgZm9yIChjb25zdCBhZGRyQmFsYW5jZSBvZiBiYWxhbmNlc1ZhbHVlcykgewogICAgICB0b3RhbFN1cHBseSArPSBhZGRyQmFsYW5jZTsKICAgIH0KICAgIENvbnRyYWN0QXNzZXJ0KHRvdGFsU3VwcGx5ICsgcXR5IDwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsICJRdHkgaXMgdG9vIGxhcmdlIik7CiAgICBsZXQgbG9ja0xlbmd0aCA9IHt9OwogICAgaWYgKGlucHV0LmxvY2tMZW5ndGgpIHsKICAgICAgQ29udHJhY3RBc3NlcnQoTnVtYmVyLmlzSW50ZWdlcihpbnB1dC5sb2NrTGVuZ3RoKSwgJ0ludmFsaWQgdmFsdWUgZm9yICJsb2NrTGVuZ3RoIi4gTXVzdCBiZSBhbiBpbnRlZ2VyJyk7CiAgICAgIENvbnRyYWN0QXNzZXJ0KGlucHV0LmxvY2tMZW5ndGggPiBzZXR0aW5ncy5nZXQoImxvY2tNaW5MZW5ndGgiKSAmJiBpbnB1dC5sb2NrTGVuZ3RoIDwgc2V0dGluZ3MuZ2V0KCJsb2NrTWF4TGVuZ3RoIiksIGBJbnB1dCBmb3IgImxvY2tMZW5ndGgiIGlzIG91dCBvZiByYW5nZSwgbXVzdCBiZSBiZXR3ZWVuICR7c2V0dGluZ3MuZ2V0KCJsb2NrTWluTGVuZ3RoIil9IGFuZCAke3NldHRpbmdzLmdldCgibG9ja01heExlbmd0aCIpfWApOwogICAgICBsb2NrTGVuZ3RoID0geyBsb2NrTGVuZ3RoOiBpbnB1dC5sb2NrTGVuZ3RoIH07CiAgICB9CiAgICBPYmplY3QuYXNzaWduKHZvdGUsIHsKICAgICAgcmVjaXBpZW50LAogICAgICBxdHkKICAgIH0sIGxvY2tMZW5ndGgpOwogICAgdm90ZXMucHVzaCh2b3RlKTsKICB9IGVsc2UgaWYgKHZvdGVUeXBlID09PSAiYnVyblZhdWx0IikgewogICAgY29uc3QgdGFyZ2V0ID0gaW5wdXQudGFyZ2V0OwogICAgQ29udHJhY3RBc3NlcnQoaXNBZGRyZXNzKHRhcmdldCksICJUYXJnZXQgYWRkcmVzcyBpcyBub3QgYSB2YWxpZCBhZGRyZXNzIik7CiAgICBPYmplY3QuYXNzaWduKHZvdGUsIHsKICAgICAgdGFyZ2V0CiAgICB9KTsKICAgIHZvdGVzLnB1c2godm90ZSk7CiAgfSBlbHNlIGlmICh2b3RlVHlwZSA9PT0gInNldCIpIHsKICAgIENvbnRyYWN0QXNzZXJ0KHR5cGVvZiBpbnB1dC5rZXkgPT09ICJzdHJpbmciLCAiRGF0YSB0eXBlIG9mIGtleSBub3Qgc3VwcG9ydGVkIik7CiAgICBpZiAoaW5wdXQua2V5ID09PSAicXVvcnVtIiB8fCBpbnB1dC5rZXkgPT09ICJzdXBwb3J0IiB8fCBpbnB1dC5rZXkgPT09ICJsb2NrTWluTGVuZ3RoIiB8fCBpbnB1dC5rZXkgPT09ICJsb2NrTWF4TGVuZ3RoIikgewogICAgICBpbnB1dC52YWx1ZSA9ICtpbnB1dC52YWx1ZTsKICAgIH0KICAgIENvbnRyYWN0QXNzZXJ0KGlucHV0LmtleSAhPT0gInF1b3J1bSIgfHwgIWlzTmFOKGlucHV0LnZhbHVlKSAmJiBpbnB1dC52YWx1ZSA-PSAwLjAxICYmIGlucHV0LnZhbHVlIDw9IDAuOTksICJRdW9ydW0gbXVzdCBiZSBiZXR3ZWVuIDAuMDEgYW5kIDAuOTkiKTsKICAgIENvbnRyYWN0QXNzZXJ0KGlucHV0LmtleSAhPT0gInN1cHBvcnQiIHx8ICFpc05hTihpbnB1dC52YWx1ZSkgJiYgaW5wdXQudmFsdWUgPj0gMC4wMSAmJiBpbnB1dC52YWx1ZSA8PSAwLjk5LCAiUXVvcnVtIG11c3QgYmUgYmV0d2VlbiAwLjAxIGFuZCAwLjk5Iik7CiAgICBDb250cmFjdEFzc2VydChpbnB1dC5rZXkgIT09ICJsb2NrTWluTGVuZ3RoIiB8fCBOdW1iZXIuaXNJbnRlZ2VyKGlucHV0LnZhbHVlKSAmJiBpbnB1dC52YWx1ZSA-PSAxICYmIGlucHV0LnZhbHVlIDwgc2V0dGluZ3MuZ2V0KCJsb2NrTWF4TGVuZ3RoIiksICJsb2NrTWluTGVuZ3RoIGNhbm5vdCBiZSBsZXNzIHRoYW4gMSBhbmQgY2Fubm90IGJlIGVxdWFsIG9yIGdyZWF0ZXIgdGhhbiBsb2NrTWF4TGVuZ3RoIik7CiAgICBDb250cmFjdEFzc2VydChpbnB1dC5rZXkgIT09ICJsb2NrTWF4TGVuZ3RoIiB8fCBOdW1iZXIuaXNJbnRlZ2VyKGlucHV0LnZhbHVlKSAmJiBpbnB1dC52YWx1ZSA-IHNldHRpbmdzLmdldCgibG9ja01pbkxlbmd0aCIpLCAibG9ja01heExlbmd0aCBjYW5ub3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIGxvY2tNaW5MZW5ndGgiKTsKICAgIGlmIChpbnB1dC5rZXkgPT09ICJyb2xlIikgewogICAgICBjb25zdCByZWNpcGllbnQgPSBpbnB1dC5yZWNpcGllbnQ7CiAgICAgIENvbnRyYWN0QXNzZXJ0KGlzQWRkcmVzcyhyZWNpcGllbnQpLCAiSW52YWxpZCByZWNpcGllbnQgYWRkcmVzcyIpOwogICAgICBPYmplY3QuYXNzaWduKHZvdGUsIHsKICAgICAgICBrZXk6IGlucHV0LmtleSwKICAgICAgICB2YWx1ZTogaW5wdXQudmFsdWUsCiAgICAgICAgcmVjaXBpZW50CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgT2JqZWN0LmFzc2lnbih2b3RlLCB7CiAgICAgICAga2V5OiBpbnB1dC5rZXksCiAgICAgICAgdmFsdWU6IGlucHV0LnZhbHVlCiAgICAgIH0pOwogICAgfQogICAgdm90ZXMucHVzaCh2b3RlKTsKICB9IGVsc2UgaWYgKHZvdGVUeXBlID09PSAiaW5kaWNhdGl2ZSIpIHsKICAgIHZvdGVzLnB1c2godm90ZSk7CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBDb250cmFjdEVycm9yKCJJbnZhbGlkIHZvdGUgdHlwZSIpOwogIH0KICByZXR1cm4gc3RhdGU7Cn0KCi8vIHNyYy9tb2R1bGVzL3ZvdGUudHMKZnVuY3Rpb24gVm90ZShzdGF0ZSwgYWN0aW9uKSB7CiAgY29uc3QgaW5wdXQgPSBhY3Rpb24uaW5wdXQ7CiAgY29uc3QgY2FsbGVyID0gYWN0aW9uLmNhbGxlcjsKICBjb25zdCBpZCA9IGlucHV0LmlkOwogIGNvbnN0IGNhc3QgPSBpbnB1dC5jYXN0OwogIENvbnRyYWN0QXNzZXJ0KE51bWJlci5pc0ludGVnZXIoaWQpIHx8ICFSRVNUUklDVF9UT19JTlRFR0VSLCAnSW52YWxpZCB2YWx1ZSBmb3IgImlkIi4gTXVzdCBiZSBhbiBpbnRlZ2VyJyk7CiAgY29uc3Qgdm90ZXMgPSBzdGF0ZS52b3RlczsKICBjb25zdCB2b3RlID0gdm90ZXNbaWRdOwogIGNvbnN0IHZhdWx0ID0gc3RhdGUudmF1bHQ7CiAgbGV0IHZvdGVyQmFsYW5jZSA9IDA7CiAgaWYgKGNhbGxlciBpbiB2YXVsdCkgewogICAgZm9yIChsZXQgaSA9IDAsIGogPSB2YXVsdFtjYWxsZXJdLmxlbmd0aDsgaSA8IGo7IGkrKykgewogICAgICBjb25zdCBsb2NrZWQgPSB2YXVsdFtjYWxsZXJdW2ldOwogICAgICBpZiAobG9ja2VkLnN0YXJ0IDwgdm90ZS5zdGFydCAmJiBsb2NrZWQuZW5kID49IHZvdGUuc3RhcnQpIHsKICAgICAgICB2b3RlckJhbGFuY2UgKz0gbG9ja2VkLmJhbGFuY2UgKiAobG9ja2VkLmVuZCAtIGxvY2tlZC5zdGFydCk7CiAgICAgIH0KICAgIH0KICB9CiAgQ29udHJhY3RBc3NlcnQodm90ZXJCYWxhbmNlID4gMCwgIkNhbGxlciBkb2VzIG5vdCBoYXZlIGxvY2tlZCBiYWxhbmNlcyBmb3IgdGhpcyB2b3RlIik7CiAgQ29udHJhY3RBc3NlcnQoIXZvdGUudm90ZWQuaW5jbHVkZXMoY2FsbGVyKSwgIkNhbGxlciBoYXMgYWxyZWFkeSB2b3RlZCIpOwogIGNvbnN0IHNldHRpbmdzID0gbmV3IE1hcChzdGF0ZS5zZXR0aW5ncyk7CiAgQ29udHJhY3RBc3NlcnQoK1NtYXJ0V2VhdmUuYmxvY2suaGVpZ2h0IDwgdm90ZS5zdGFydCArIHNldHRpbmdzLmdldCgidm90ZUxlbmd0aCIpLCAiVm90ZSBoYXMgYWxyZWFkeSBjb25jbHVkZWQiKTsKICBpZiAoY2FzdCA9PT0gInlheSIpIHsKICAgIHZvdGUueWF5cyArPSB2b3RlckJhbGFuY2U7CiAgfSBlbHNlIGlmIChjYXN0ID09PSAibmF5IikgewogICAgdm90ZS5uYXlzICs9IHZvdGVyQmFsYW5jZTsKICB9IGVsc2UgewogICAgdGhyb3cgbmV3IENvbnRyYWN0RXJyb3IoIlZvdGUgY2FzdCB0eXBlIHVucmVjb2duaXNlZCIpOwogIH0KICB2b3RlLnZvdGVkLnB1c2goY2FsbGVyKTsKICByZXR1cm4gc3RhdGU7Cn0KCi8vIHNyYy9tb2R1bGVzL2ZpbmFsaXplLnRzCmZ1bmN0aW9uIEZpbmFsaXplKHN0YXRlLCBhY3Rpb24pIHsKICBjb25zdCBpbnB1dCA9IGFjdGlvbi5pbnB1dDsKICBjb25zdCBpZCA9IGlucHV0LmlkOwogIGNvbnN0IHZvdGVzID0gc3RhdGUudm90ZXM7CiAgY29uc3Qgdm90ZSA9IHZvdGVzW2lkXTsKICBjb25zdCBxdHkgPSB2b3RlLnF0eTsKICBDb250cmFjdEFzc2VydCghIXZvdGUsICJUaGlzIHZvdGUgZG9lc24ndCBleGlzdCIpOwogIGNvbnN0IHNldHRpbmdzID0gbmV3IE1hcChzdGF0ZS5zZXR0aW5ncyk7CiAgQ29udHJhY3RBc3NlcnQoK1NtYXJ0V2VhdmUuYmxvY2suaGVpZ2h0ID49IHZvdGUuc3RhcnQgKyBzZXR0aW5ncy5nZXQoInZvdGVMZW5ndGgiKSwgIlZvdGUgaGFzIG5vdCB5ZXQgY29uY2x1ZGVkIik7CiAgQ29udHJhY3RBc3NlcnQodm90ZS5zdGF0dXMgPT09ICJhY3RpdmUiLCAiVm90ZSBpcyBub3QgYWN0aXZlIik7CiAgaWYgKHZvdGUudG90YWxXZWlnaHQgKiBzZXR0aW5ncy5nZXQoInF1b3J1bSIpID4gdm90ZS55YXlzICsgdm90ZS5uYXlzKSB7CiAgICB2b3RlLnN0YXR1cyA9ICJxdW9ydW1GYWlsZWQiOwogICAgcmV0dXJuIHN0YXRlOwogIH0KICBjb25zdCB2YXVsdCA9IHN0YXRlLnZhdWx0OwogIGNvbnN0IGJhbGFuY2VzID0gc3RhdGUuYmFsYW5jZXM7CiAgaWYgKHZvdGUueWF5cyAhPT0gMCAmJiAodm90ZS5uYXlzID09PSAwIHx8IHZvdGUueWF5cyAvIHZvdGUubmF5cyA-IHNldHRpbmdzLmdldCgic3VwcG9ydCIpKSkgewogICAgdm90ZS5zdGF0dXMgPSAicGFzc2VkIjsKICAgIGlmICh2b3RlLnR5cGUgPT09ICJtaW50IiB8fCB2b3RlLnR5cGUgPT09ICJtaW50TG9ja2VkIikgewogICAgICBsZXQgdG90YWxTdXBwbHkgPSAwOwogICAgICBjb25zdCB2YXVsdFZhbHVlcyA9IE9iamVjdC52YWx1ZXModmF1bHQpOwogICAgICBmb3IgKGNvbnN0IGxvY2tlZCBvZiB2YXVsdFZhbHVlcykgewogICAgICAgIGZvciAoY29uc3QgbG9ja2VkSXRlbSBvZiBsb2NrZWQpIHsKICAgICAgICAgIHRvdGFsU3VwcGx5ICs9IGxvY2tlZEl0ZW0uYmFsYW5jZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgYmFsYW5jZXNWYWx1ZXMgPSBPYmplY3QudmFsdWVzKGJhbGFuY2VzKTsKICAgICAgZm9yIChjb25zdCBiYWxhbmNlIG9mIGJhbGFuY2VzVmFsdWVzKSB7CiAgICAgICAgdG90YWxTdXBwbHkgKz0gYmFsYW5jZTsKICAgICAgfQogICAgICBDb250cmFjdEFzc2VydCh0b3RhbFN1cHBseSArIHF0eSA8PSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiwgIlF1YW50aXR5IGlzIHRvbyBsYXJnZSIpOwogICAgfQogICAgaWYgKHZvdGUudHlwZSA9PT0gIm1pbnQiKSB7CiAgICAgIGlmICh2b3RlLnJlY2lwaWVudCBpbiBiYWxhbmNlcykgewogICAgICAgIGJhbGFuY2VzW3ZvdGUucmVjaXBpZW50XSArPSBxdHk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYmFsYW5jZXNbdm90ZS5yZWNpcGllbnRdID0gcXR5OwogICAgICB9CiAgICB9IGVsc2UgaWYgKHZvdGUudHlwZSA9PT0gIm1pbnRMb2NrZWQiKSB7CiAgICAgIGNvbnN0IHN0YXJ0ID0gK1NtYXJ0V2VhdmUuYmxvY2suaGVpZ2h0OwogICAgICBjb25zdCBlbmQgPSBzdGFydCArIHZvdGUubG9ja0xlbmd0aDsKICAgICAgY29uc3QgbG9ja2VkID0gewogICAgICAgIGJhbGFuY2U6IHF0eSwKICAgICAgICBzdGFydCwKICAgICAgICBlbmQKICAgICAgfTsKICAgICAgaWYgKHZvdGUucmVjaXBpZW50IGluIHZhdWx0KSB7CiAgICAgICAgdmF1bHRbdm90ZS5yZWNpcGllbnRdLnB1c2gobG9ja2VkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXVsdFt2b3RlLnJlY2lwaWVudF0gPSBbbG9ja2VkXTsKICAgICAgfQogICAgfSBlbHNlIGlmICh2b3RlLnR5cGUgPT09ICJidXJuVmF1bHQiKSB7CiAgICAgIGlmICh2b3RlLnRhcmdldCBpbiB2YXVsdCkgewogICAgICAgIGRlbGV0ZSB2YXVsdFt2b3RlLnRhcmdldF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdm90ZS5zdGF0dXMgPSAiZmFpbGVkIjsKICAgICAgfQogICAgfSBlbHNlIGlmICh2b3RlLnR5cGUgPT09ICJzZXQiKSB7CiAgICAgIGlmICh2b3RlLmtleSA9PT0gInJvbGUiKSB7CiAgICAgICAgc3RhdGUucm9sZXNbdm90ZS5yZWNpcGllbnRdID0gdm90ZS52YWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZXR0aW5ncy5zZXQodm90ZS5rZXksIHZvdGUudmFsdWUpOwogICAgICAgIHN0YXRlLnNldHRpbmdzID0gQXJyYXkuZnJvbShzZXR0aW5ncyk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgdm90ZS5zdGF0dXMgPSAiZmFpbGVkIjsKICB9CiAgcmV0dXJuIHN0YXRlOwp9CgovLyBzcmMvbW9kdWxlcy9yb2xlLnRzCmZ1bmN0aW9uIFJvbGUoc3RhdGUsIGFjdGlvbikgewogIGNvbnN0IGlucHV0ID0gYWN0aW9uLmlucHV0OwogIGNvbnN0IGNhbGxlciA9IGFjdGlvbi5jYWxsZXI7CiAgY29uc3QgdGFyZ2V0ID0gaW5wdXQudGFyZ2V0IHx8IGNhbGxlcjsKICBDb250cmFjdEFzc2VydChpc0FkZHJlc3ModGFyZ2V0KSwgIkludmFsaWQgdGFyZ2V0IGFkZHJlc3MiKTsKICBjb25zdCByb2xlID0gdGFyZ2V0IGluIHN0YXRlLnJvbGVzID8gc3RhdGUucm9sZXNbdGFyZ2V0XSA6ICIiOwogIENvbnRyYWN0QXNzZXJ0KCEhcm9sZS50cmltKCkubGVuZ3RoLCAiVGFyZ2V0IGRvZXNuJ3QgaGF2ZSBhIHJvbGUgc3BlY2lmaWVkIik7CiAgcmV0dXJuIHsgdGFyZ2V0LCByb2xlIH07Cn0KCi8vIHNyYy9pbmRleC50cwpleHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlKHN0YXRlLCBhY3Rpb24pIHsKICBzd2l0Y2ggKGFjdGlvbi5pbnB1dC5mdW5jdGlvbikgewogICAgY2FzZSAidHJhbnNmZXIiOgogICAgICByZXR1cm4geyBzdGF0ZTogVHJhbnNmZXIoc3RhdGUsIGFjdGlvbikgfTsKICAgIGNhc2UgInRyYW5zZmVyTG9ja2VkIjoKICAgICAgcmV0dXJuIHsgc3RhdGU6IFRyYW5zZmVyTG9ja2VkKHN0YXRlLCBhY3Rpb24pIH07CiAgICBjYXNlICJiYWxhbmNlIjoKICAgICAgcmV0dXJuIHsgcmVzdWx0OiBCYWxhbmNlKHN0YXRlLCBhY3Rpb24pIH07CiAgICBjYXNlICJ1bmxvY2tlZEJhbGFuY2UiOgogICAgICByZXR1cm4geyByZXN1bHQ6IFVubG9ja2VkQmFsYW5jZShzdGF0ZSwgYWN0aW9uKSB9OwogICAgY2FzZSAibG9jayI6CiAgICAgIHJldHVybiB7IHN0YXRlOiBMb2NrKHN0YXRlLCBhY3Rpb24pIH07CiAgICBjYXNlICJpbmNyZWFzZVZhdWx0IjoKICAgICAgcmV0dXJuIHsgc3RhdGU6IEluY3JlYXNlVmF1bHQoc3RhdGUsIGFjdGlvbikgfTsKICAgIGNhc2UgInVubG9jayI6CiAgICAgIHJldHVybiB7IHN0YXRlOiBVbmxvY2soc3RhdGUsIGFjdGlvbikgfTsKICAgIGNhc2UgInZhdWx0QmFsYW5jZSI6CiAgICAgIHJldHVybiB7IHJlc3VsdDogVmF1bHRCYWxhbmNlKHN0YXRlLCBhY3Rpb24pIH07CiAgICBjYXNlICJwcm9wb3NlIjoKICAgICAgcmV0dXJuIHsgc3RhdGU6IFByb3Bvc2Uoc3RhdGUsIGFjdGlvbikgfTsKICAgIGNhc2UgInZvdGUiOgogICAgICByZXR1cm4geyBzdGF0ZTogVm90ZShzdGF0ZSwgYWN0aW9uKSB9OwogICAgY2FzZSAiZmluYWxpemUiOgogICAgICByZXR1cm4geyBzdGF0ZTogRmluYWxpemUoc3RhdGUsIGFjdGlvbikgfTsKICAgIGNhc2UgInJvbGUiOgogICAgICByZXR1cm4geyByZXN1bHQ6IFJvbGUoc3RhdGUsIGFjdGlvbikgfTsKICAgIGNhc2UgInJlYWRPdXRib3giOgogICAgICByZXR1cm4geyBzdGF0ZTogYXdhaXQgUmVhZE91dGJveChzdGF0ZSwgYWN0aW9uKSB9OwogICAgY2FzZSAiaW52b2tlIjoKICAgICAgcmV0dXJuIHsgc3RhdGU6IGF3YWl0IEludm9rZShzdGF0ZSwgYWN0aW9uKSB9OwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IENvbnRyYWN0RXJyb3IoYEludmFsaWQgZnVuY3Rpb246ICIke2FjdGlvbi5pbnB1dC5mdW5jdGlvbn0iYCk7CiAgfQp9Cg