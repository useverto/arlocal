LyoKICogCiAqIE1JVCBMaWNlbnNlCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMjEtIFRoZSBWZXJ0byBQcm90b2NvbAogKiAKICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weQogKiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbAogKiBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzCiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGwKICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzCiAqIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6CiAqIAogKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGwKICogY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS4KICogCiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SCiAqIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLAogKiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUKICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUgogKiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLAogKiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRQogKiBTT0ZUV0FSRS4KICogCiAqIAogKi8KCi8vIHNyYy9jbG9iL21vZHVsZXMvdG9nZ2xlUGFpckdhdGVrZWVwZXIudHMKdmFyIFRvZ2dsZVBhaXJHYXRla2VlcGVyID0gKHN0YXRlLCBhY3Rpb24pID0-IHsKICBjb25zdCBjYWxsZXIgPSBhY3Rpb24uY2FsbGVyOwogIENvbnRyYWN0QXNzZXJ0KGNhbGxlciA9PT0gc3RhdGUuZW1lcmdlbmN5SGFsdFdhbGxldCwgIkNhbGxlciBjYW5ub3QgdG9nZ2xlIHRoZSBnYXRla2VlcGVyIik7CiAgcmV0dXJuIHsuLi5zdGF0ZSwgcGFpckdhdGVrZWVwZXI6ICFzdGF0ZS5wYWlyR2F0ZWtlZXBlcn07Cn07CgovLyBzcmMvY2xvYi91dGlscy50cwp2YXIgZW5zdXJlVmFsaWRUcmFuc2ZlciA9IGFzeW5jICh0b2tlbklELCB0cmFuc2ZlclR4KSA9PiB7CiAgYXdhaXQgZW5zdXJlVmFsaWRJbnRlcmFjdGlvbih0b2tlbklELCB0cmFuc2ZlclR4KTsKICB0cnkgewogICAgY29uc3QgdHggPSBhd2FpdCBTbWFydFdlYXZlLnVuc2FmZUNsaWVudC50cmFuc2FjdGlvbnMuZ2V0KHRyYW5zZmVyVHgpOwogICAgdHguZ2V0KCJ0YWdzIikuZm9yRWFjaCgodGFnKSA9PiB7CiAgICAgIGlmICh0YWcuZ2V0KCJuYW1lIiwge2RlY29kZTogdHJ1ZSwgc3RyaW5nOiB0cnVlfSkgPT09ICJJbnB1dCIpIHsKICAgICAgICBjb25zdCBpbnB1dCA9IEpTT04ucGFyc2UodGFnLmdldCgidmFsdWUiLCB7ZGVjb2RlOiB0cnVlLCBzdHJpbmc6IHRydWV9KSk7CiAgICAgICAgQ29udHJhY3RBc3NlcnQoaW5wdXQuZnVuY3Rpb24gPT09ICJ0cmFuc2ZlciIsICJUaGUgaW50ZXJhY3Rpb24gaXMgbm90IGEgdHJhbnNmZXIiKTsKICAgICAgICBDb250cmFjdEFzc2VydChpbnB1dC50YXJnZXQgPT09IFNtYXJ0V2VhdmUudHJhbnNhY3Rpb24udGFncy5maW5kKCh7bmFtZX0pID0-IG5hbWUgPT09ICJDb250cmFjdCIpLnZhbHVlLCAiVGhlIHRhcmdldCBvZiB0aGlzIHRyYW5zZmVyIGlzIG5vdCB0aGlzIGNvbnRyYWN0Iik7CiAgICAgIH0KICAgIH0pOwogIH0gY2F0Y2ggKGVycikgewogICAgdGhyb3cgbmV3IENvbnRyYWN0RXJyb3IoZXJyKTsKICB9Cn07CnZhciBlbnN1cmVWYWxpZEludGVyYWN0aW9uID0gYXN5bmMgKGNvbnRyYWN0SUQsIGludGVyYWN0aW9uSUQpID0-IHsKICBjb25zdCB7CiAgICB2YWxpZGl0eTogY29udHJhY3RUeFZhbGlkaXRpZXMKICB9ID0gYXdhaXQgU21hcnRXZWF2ZS5jb250cmFjdHMucmVhZENvbnRyYWN0U3RhdGUoY29udHJhY3RJRCwgdm9pZCAwLCB0cnVlKTsKICBDb250cmFjdEFzc2VydChpbnRlcmFjdGlvbklEIGluIGNvbnRyYWN0VHhWYWxpZGl0aWVzLCAiVGhlIGludGVyYWN0aW9uIGlzIG5vdCBhc3NvY2lhdGVkIHdpdGggdGhpcyBjb250cmFjdCIpOwogIENvbnRyYWN0QXNzZXJ0KGNvbnRyYWN0VHhWYWxpZGl0aWVzW2ludGVyYWN0aW9uSURdLCAiVGhlIGludGVyYWN0aW9uIHdhcyBpbnZhbGlkIik7Cn07CnZhciBpc0FkZHJlc3MgPSAoYWRkcikgPT4gL1thLXowLTlfLV17NDN9L2kudGVzdChhZGRyKTsKCi8vIHNyYy9jbG9iL21vZHVsZXMvc2V0Q29tbXVuaXR5Q29udHJhY3QudHMKdmFyIFNldENvbW11bml0eUNvbnRyYWN0ID0gKHN0YXRlLCBhY3Rpb24pID0-IHsKICBjb25zdCBjYWxsZXIgPSBhY3Rpb24uY2FsbGVyOwogIGNvbnN0IHtpZH0gPSBhY3Rpb24uaW5wdXQ7CiAgQ29udHJhY3RBc3NlcnQoY2FsbGVyID09PSBzdGF0ZS5lbWVyZ2VuY3lIYWx0V2FsbGV0LCAiQ2FsbGVyIGNhbm5vdCBzZXQgdGhlIGNvbW11bml0eSBjb250cmFjdCIpOwogIENvbnRyYWN0QXNzZXJ0KGlzQWRkcmVzcyhpZCksICJJbnZhbGlkIElEIHN1cHBsaWVkIik7CiAgcmV0dXJuIHsuLi5zdGF0ZSwgY29tbXVuaXR5Q29udHJhY3Q6IGlkfTsKfTsKCi8vIHNyYy9jbG9iL21vZHVsZXMvZm9yZWlnblRyYW5zZmVyLnRzCnZhciBGb3JlaWduVHJhbnNmZXIgPSAoc3RhdGUsIGFjdGlvbikgPT4gewogIGNvbnN0IGNhbGxlciA9IGFjdGlvbi5jYWxsZXI7CiAgY29uc3QgaW5wdXQgPSBhY3Rpb24uaW5wdXQ7CiAgQ29udHJhY3RBc3NlcnQoY2FsbGVyID09PSBzdGF0ZS5lbWVyZ2VuY3lIYWx0V2FsbGV0LCAiQ2FsbGVyIGNhbm5vdCBpc3N1ZSBhIGZvcmVpZ24gdHJhbnNmZXIiKTsKICBDb250cmFjdEFzc2VydChpbnB1dC5xdHkgJiYgISFpbnB1dC50YXJnZXQgJiYgISFpbnB1dC50b2tlbklELCAiTWlzc2luZyBwYXJhbWV0ZXJzIik7CiAgc3RhdGUuZm9yZWlnbkNhbGxzLnB1c2goewogICAgdHhJRDogU21hcnRXZWF2ZS50cmFuc2FjdGlvbi5pZCwKICAgIGNvbnRyYWN0OiBpbnB1dC50b2tlbklELAogICAgaW5wdXQ6IHsKICAgICAgZnVuY3Rpb246ICJ0cmFuc2ZlciIsCiAgICAgIHRhcmdldDogaW5wdXQudGFyZ2V0LAogICAgICBxdHk6IGlucHV0LnF0eQogICAgfQogIH0pOwogIHJldHVybiBzdGF0ZTsKfTsKCi8vIHNyYy9jbG9iL21vZHVsZXMvY3JlYXRlT3JkZXIudHMKdmFyIENyZWF0ZU9yZGVyID0gYXN5bmMgKHN0YXRlLCBhY3Rpb24pID0-IHsKICBjb25zdCBjYWxsZXIgPSBhY3Rpb24uY2FsbGVyOwogIGNvbnN0IGlucHV0ID0gYWN0aW9uLmlucHV0OwogIGNvbnN0IHBhaXJzID0gc3RhdGUucGFpcnM7CiAgY29uc3QgdXNlZFBhaXIgPSBpbnB1dC5wYWlyOwogIGNvbnN0IHRva2VuVHggPSBpbnB1dC50cmFuc2FjdGlvbjsKICBjb25zdCBwcmljZSA9IGlucHV0LnByaWNlOwogIENvbnRyYWN0QXNzZXJ0KGlzQWRkcmVzcyh1c2VkUGFpclswXSkgJiYgaXNBZGRyZXNzKHVzZWRQYWlyWzFdKSwgIk9uZSBvZiB0d28gc3VwcGxpZWQgcGFpcnMgaXMgaW52YWxpZCIpOwogIGNvbnN0IHBhaXJJbmRleCA9IHBhaXJzLmZpbmRJbmRleCgoe3BhaXJ9KSA9PiBwYWlyLmluY2x1ZGVzKHVzZWRQYWlyWzBdKSAmJiBwYWlyLmluY2x1ZGVzKHVzZWRQYWlyWzFdKSk7CiAgQ29udHJhY3RBc3NlcnQocGFpckluZGV4ICE9PSB2b2lkIDAsICJUaGlzIHBhaXIgZG9lcyBub3QgZXhpc3QgeWV0Iik7CiAgbGV0IGNvbnRyYWN0SUQgPSAiIiwgY29udHJhY3RJbnB1dCwgdHJhbnNmZXJUeDsKICB0cnkgewogICAgdHJhbnNmZXJUeCA9IGF3YWl0IFNtYXJ0V2VhdmUudW5zYWZlQ2xpZW50LnRyYW5zYWN0aW9ucy5nZXQodG9rZW5UeCk7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICB0aHJvdyBuZXcgQ29udHJhY3RFcnJvcihlcnIpOwogIH0KICB0cmFuc2ZlclR4LmdldCgidGFncyIpLmZvckVhY2goKHRhZykgPT4gewogICAgaWYgKHRhZy5nZXQoIm5hbWUiLCB7ZGVjb2RlOiB0cnVlLCBzdHJpbmc6IHRydWV9KSA9PT0gIkNvbnRyYWN0IikgewogICAgICBjb250cmFjdElEID0gdGFnLmdldCgidmFsdWUiLCB7ZGVjb2RlOiB0cnVlLCBzdHJpbmc6IHRydWV9KTsKICAgIH0KICAgIGlmICh0YWcuZ2V0KCJuYW1lIiwge2RlY29kZTogdHJ1ZSwgc3RyaW5nOiB0cnVlfSkgPT09ICJJbnB1dCIpIHsKICAgICAgY29udHJhY3RJbnB1dCA9IEpTT04ucGFyc2UodGFnLmdldCgidmFsdWUiLCB7ZGVjb2RlOiB0cnVlLCBzdHJpbmc6IHRydWV9KSk7CiAgICB9CiAgfSk7CiAgQ29udHJhY3RBc3NlcnQodHlwZW9mIGNvbnRyYWN0SUQgPT09ICJzdHJpbmciLCAiSW52YWxpZCBjb250cmFjdCBJRDogbm90IGEgc3RyaW5nIik7CiAgQ29udHJhY3RBc3NlcnQoY29udHJhY3RJRCAhPT0gIiIsICJObyBjb250cmFjdCBJRCBmb3VuZCBpbiB0aGUgdHJhbnNmZXIgdHJhbnNhY3Rpb24iKTsKICBjb25zdCBmcm9tVG9rZW4gPSB1c2VkUGFpclswXTsKICBDb250cmFjdEFzc2VydChmcm9tVG9rZW4gPT09IGNvbnRyYWN0SUQsICJJbnZhbGlkIHRyYW5zZmVyIHRyYW5zYWN0aW9uLCB1c2luZyB0aGUgd3JvbmcgdG9rZW4uIFRoZSB0cmFuc2ZlcnJlZCB0b2tlbiBoYXMgdG8gYmUgdGhlIGZpcnN0IGl0ZW0gaW4gdGhlIHBhaXIiKTsKICBDb250cmFjdEFzc2VydChpc0FkZHJlc3MoY29udHJhY3RJRCksICJJbnZhbGlkIGNvbnRyYWN0IElEIGZvcm1hdCIpOwogIGF3YWl0IGVuc3VyZVZhbGlkVHJhbnNmZXIoY29udHJhY3RJRCwgdG9rZW5UeCk7CiAgbGV0IHNvcnRlZE9yZGVyYm9vayA9IHN0YXRlLnBhaXJzW3BhaXJJbmRleF0ub3JkZXJzLnNvcnQoKGEsIGIpID0-IGEucHJpY2UgPiBiLnByaWNlID8gMSA6IC0xKTsKICBjb25zdCB7b3JkZXJib29rLCBmb3JlaWduQ2FsbHN9ID0gbWF0Y2hPcmRlcihjb250cmFjdElELCBjb250cmFjdElucHV0LnF0eSwgY2FsbGVyLCBTbWFydFdlYXZlLnRyYW5zYWN0aW9uLmlkLCB0b2tlblR4LCBzb3J0ZWRPcmRlcmJvb2ssIHByaWNlKTsKICBzdGF0ZS5wYWlyc1twYWlySW5kZXhdLm9yZGVycyA9IG9yZGVyYm9vazsKICBzdGF0ZS5wYWlyc1twYWlySW5kZXhdLnByaWNlTG9ncyA9IHsKICAgIG9yZGVySUQ6IFNtYXJ0V2VhdmUudHJhbnNhY3Rpb24uaWQsCiAgICB0b2tlbjogZnJvbVRva2VuLAogICAgbG9nczogW10KICB9OwogIGZvciAobGV0IGkgPSAwOyBpIDwgZm9yZWlnbkNhbGxzLmxlbmd0aDsgaSsrKSB7CiAgICBzdGF0ZS5mb3JlaWduQ2FsbHMucHVzaChmb3JlaWduQ2FsbHNbaV0pOwogIH0KICByZXR1cm4gc3RhdGU7Cn07CmZ1bmN0aW9uIG1hdGNoT3JkZXIoaW5wdXRUb2tlbiwgaW5wdXRRdWFudGl0eSwgaW5wdXRDcmVhdG9yLCBpbnB1dFRyYW5zYWN0aW9uLCBpbnB1dFRyYW5zZmVyLCBvcmRlcmJvb2ssIGlucHV0UHJpY2UsIGZvcmVpZ25DYWxscyA9IFtdLCBsb2dzID0gW10pIHsKICBjb25zdCBvcmRlclB1c2hlZCA9ICEhb3JkZXJib29rLmZpbmQoKG9yZGVyKSA9PiBvcmRlci5pZCA9PT0gaW5wdXRUcmFuc2FjdGlvbik7CiAgbGV0IGZpbGxBbW91bnQ7CiAgaWYgKG9yZGVyYm9vay5maWx0ZXIoKG9yZGVyKSA9PiBpbnB1dFRva2VuICE9PSBvcmRlci50b2tlbiAmJiBvcmRlci5pZCAhPT0gaW5wdXRUcmFuc2FjdGlvbikubGVuZ3RoID09PSAwKSB7CiAgICBDb250cmFjdEFzc2VydCghIWlucHV0UHJpY2UsICJJbnB1dCBwcmljZSBzaG91bGQgYmUgZGVmaW5lZCBmb3IgdGhlIGZpcnN0IG9yZGVyIHRvIGEgcGFpciIpOwogICAgaWYgKG9yZGVyUHVzaGVkKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3JkZXJib29rLAogICAgICAgIGZvcmVpZ25DYWxscwogICAgICB9OwogICAgfQogICAgcmV0dXJuIHsKICAgICAgb3JkZXJib29rOiBbCiAgICAgICAgLi4ub3JkZXJib29rLAogICAgICAgIHsKICAgICAgICAgIGlkOiBpbnB1dFRyYW5zYWN0aW9uLAogICAgICAgICAgdHJhbnNmZXI6IGlucHV0VHJhbnNmZXIsCiAgICAgICAgICBjcmVhdG9yOiBpbnB1dENyZWF0b3IsCiAgICAgICAgICB0b2tlbjogaW5wdXRUb2tlbiwKICAgICAgICAgIHByaWNlOiBpbnB1dFByaWNlLAogICAgICAgICAgcXVhbnRpdHk6IGlucHV0UXVhbnRpdHksCiAgICAgICAgICBvcmlnaW5hbFF1YW50aXR5OiBpbnB1dFF1YW50aXR5CiAgICAgICAgfQogICAgICBdLAogICAgICBmb3JlaWduQ2FsbHMKICAgIH07CiAgfQogIGZvciAobGV0IGkgPSAwOyBpIDwgb3JkZXJib29rLmxlbmd0aDsgaSsrKSB7CiAgICBpZiAoaW5wdXRUb2tlbiA9PT0gb3JkZXJib29rW2ldLnRva2VuKQogICAgICBjb250aW51ZTsKICAgIGlmIChvcmRlcmJvb2tbaV0uaWQgPT09IGlucHV0VHJhbnNhY3Rpb24pCiAgICAgIGNvbnRpbnVlOwogICAgY29uc3QgY29udmVydGVkRXhpc3RpbmdQcmljZSA9IDEgLyBvcmRlcmJvb2tbaV0ucHJpY2U7CiAgICBpZiAoaW5wdXRQcmljZSkgewogICAgICBjb25zb2xlLmxvZygiMSkgTElNSVQgT1JERVIiKTsKICAgICAgQ29udHJhY3RBc3NlcnQodHlwZW9mIGlucHV0UHJpY2UgPT09ICJudW1iZXIiLCAiSW52YWxpZCBwcmljZTogbm90IGEgbnVtYmVyIik7CiAgICAgIGZpbGxBbW91bnQgPSBpbnB1dFF1YW50aXR5ICogaW5wdXRQcmljZTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUubG9nKCIyKSBNQVJLRVQgT1JERVIiKTsKICAgICAgZmlsbEFtb3VudCA9IGlucHV0UXVhbnRpdHkgKiBjb252ZXJ0ZWRFeGlzdGluZ1ByaWNlOwogICAgfQogICAgaWYgKGlucHV0UHJpY2UgPT09IGNvbnZlcnRlZEV4aXN0aW5nUHJpY2UgfHwgIWlucHV0UHJpY2UpIHsKICAgICAgY29uc29sZS5sb2coIjMpIEZvdW5kIGNvbXBhdGlibGUgb3JkZXIiKTsKICAgICAgY29uc29sZS5sb2cob3JkZXJib29rW2ldKTsKICAgICAgaWYgKGZpbGxBbW91bnQgPT09IG9yZGVyYm9va1tpXS5xdWFudGl0eSkgewogICAgICAgIGNvbnNvbGUubG9nKCI0KSB-fiBNYXRjaGVkIG9yZGVycyBjb21wbGV0ZWx5IGZpbGxlZCB-fiIpOwogICAgICAgIGNvbnN0IHNlbmRBbW91bnQgPSBvcmRlcmJvb2tbaV0ucXVhbnRpdHk7CiAgICAgICAgZm9yZWlnbkNhbGxzLnB1c2goewogICAgICAgICAgdHhJRDogU21hcnRXZWF2ZS50cmFuc2FjdGlvbi5pZCwKICAgICAgICAgIGNvbnRyYWN0OiBpbnB1dFRva2VuLAogICAgICAgICAgaW5wdXQ6IHsKICAgICAgICAgICAgZnVuY3Rpb246ICJ0cmFuc2ZlciIsCiAgICAgICAgICAgIHRhcmdldDogb3JkZXJib29rW2ldLmNyZWF0b3IsCiAgICAgICAgICAgIHF0eTogaW5wdXRRdWFudGl0eQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIHR4SUQ6IFNtYXJ0V2VhdmUudHJhbnNhY3Rpb24uaWQsCiAgICAgICAgICBjb250cmFjdDogb3JkZXJib29rW2ldLnRva2VuLAogICAgICAgICAgaW5wdXQ6IHsKICAgICAgICAgICAgZnVuY3Rpb246ICJ0cmFuc2ZlciIsCiAgICAgICAgICAgIHRhcmdldDogaW5wdXRDcmVhdG9yLAogICAgICAgICAgICBxdHk6IHNlbmRBbW91bnQKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBsb2dzLnB1c2goewogICAgICAgICAgaWQ6IG9yZGVyYm9va1tpXS5pZCwKICAgICAgICAgIHByaWNlOiBpbnB1dFByaWNlIHx8IGNvbnZlcnRlZEV4aXN0aW5nUHJpY2UsCiAgICAgICAgICBxdHk6IHNlbmRBbW91bnQKICAgICAgICB9KTsKICAgICAgICBvcmRlcmJvb2suc3BsaWNlKGkgLSAxLCAxKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgb3JkZXJib29rLAogICAgICAgICAgZm9yZWlnbkNhbGxzLAogICAgICAgICAgbG9ncwogICAgICAgIH07CiAgICAgIH0gZWxzZSBpZiAoZmlsbEFtb3VudCA8IG9yZGVyYm9va1tpXS5xdWFudGl0eSkgewogICAgICAgIGNvbnNvbGUubG9nKCI1KSB-fiBJbnB1dCBvcmRlciBmaWxsZWQ7IGV4aXN0aW5nIG9yZGVyIG5vdCBjb21wbGV0ZWx5IGZpbGxlZCB-fiIpOwogICAgICAgIGZvcmVpZ25DYWxscy5wdXNoKHsKICAgICAgICAgIHR4SUQ6IFNtYXJ0V2VhdmUudHJhbnNhY3Rpb24uaWQsCiAgICAgICAgICBjb250cmFjdDogaW5wdXRUb2tlbiwKICAgICAgICAgIGlucHV0OiB7CiAgICAgICAgICAgIGZ1bmN0aW9uOiAidHJhbnNmZXIiLAogICAgICAgICAgICB0YXJnZXQ6IG9yZGVyYm9va1tpXS5jcmVhdG9yLAogICAgICAgICAgICBxdHk6IGlucHV0UXVhbnRpdHkKICAgICAgICAgIH0KICAgICAgICB9LCB7CiAgICAgICAgICB0eElEOiBTbWFydFdlYXZlLnRyYW5zYWN0aW9uLmlkLAogICAgICAgICAgY29udHJhY3Q6IG9yZGVyYm9va1tpXS50b2tlbiwKICAgICAgICAgIGlucHV0OiB7CiAgICAgICAgICAgIGZ1bmN0aW9uOiAidHJhbnNmZXIiLAogICAgICAgICAgICB0YXJnZXQ6IGlucHV0Q3JlYXRvciwKICAgICAgICAgICAgcXR5OiBmaWxsQW1vdW50CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgbG9ncy5wdXNoKHsKICAgICAgICAgIGlkOiBvcmRlcmJvb2tbaV0uaWQsCiAgICAgICAgICBwcmljZTogaW5wdXRQcmljZSB8fCBjb252ZXJ0ZWRFeGlzdGluZ1ByaWNlLAogICAgICAgICAgcXR5OiBmaWxsQW1vdW50CiAgICAgICAgfSk7CiAgICAgICAgb3JkZXJib29rW2ldLnF1YW50aXR5IC09IGZpbGxBbW91bnQ7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG9yZGVyYm9vaywKICAgICAgICAgIGZvcmVpZ25DYWxscywKICAgICAgICAgIGxvZ3MKICAgICAgICB9OwogICAgICB9IGVsc2UgaWYgKGZpbGxBbW91bnQgPiBvcmRlcmJvb2tbaV0ucXVhbnRpdHkpIHsKICAgICAgICBjb25zb2xlLmxvZygiNikgfn4gSW5wdXQgb3JkZXIgbm90IGNvbXBsZXRlbHkgZmlsbGVkOyBleGlzdGluZyBvcmRlciBmaWxsZWQgfn4iKTsKICAgICAgICBjb25zdCBzZW5kQW1vdW50ID0gb3JkZXJib29rW2ldLnF1YW50aXR5OwogICAgICAgIGZvcmVpZ25DYWxscy5wdXNoKHsKICAgICAgICAgIHR4SUQ6IFNtYXJ0V2VhdmUudHJhbnNhY3Rpb24uaWQsCiAgICAgICAgICBjb250cmFjdDogaW5wdXRUb2tlbiwKICAgICAgICAgIGlucHV0OiB7CiAgICAgICAgICAgIGZ1bmN0aW9uOiAidHJhbnNmZXIiLAogICAgICAgICAgICB0YXJnZXQ6IG9yZGVyYm9va1tpXS5jcmVhdG9yLAogICAgICAgICAgICBxdHk6IGlucHV0UXVhbnRpdHkgLSBzZW5kQW1vdW50ICogY29udmVydGVkRXhpc3RpbmdQcmljZQogICAgICAgICAgfQogICAgICAgIH0sIHsKICAgICAgICAgIHR4SUQ6IFNtYXJ0V2VhdmUudHJhbnNhY3Rpb24uaWQsCiAgICAgICAgICBjb250cmFjdDogb3JkZXJib29rW2ldLnRva2VuLAogICAgICAgICAgaW5wdXQ6IHsKICAgICAgICAgICAgZnVuY3Rpb246ICJ0cmFuc2ZlciIsCiAgICAgICAgICAgIHRhcmdldDogaW5wdXRDcmVhdG9yLAogICAgICAgICAgICBxdHk6IHNlbmRBbW91bnQKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBsb2dzLnB1c2goewogICAgICAgICAgaWQ6IG9yZGVyYm9va1tpXS5pZCwKICAgICAgICAgIHByaWNlOiBpbnB1dFByaWNlIHx8IGNvbnZlcnRlZEV4aXN0aW5nUHJpY2UsCiAgICAgICAgICBxdHk6IHNlbmRBbW91bnQKICAgICAgICB9KTsKICAgICAgICBjb25zb2xlLmxvZygiSU5QVVQgUVVBTlRJVFkiLCBpbnB1dFF1YW50aXR5KTsKICAgICAgICBjb25zb2xlLmxvZygiT1JERVJCT09LIE9SREVSIFFVQU5USVRZIiwgb3JkZXJib29rW2ldLnF1YW50aXR5KTsKICAgICAgICBjb25zb2xlLmxvZygiQ09OVkVSVEVEIEVYSVNUSU5HIFBSSUNFIiwgY29udmVydGVkRXhpc3RpbmdQcmljZSk7CiAgICAgICAgaWYgKCFvcmRlclB1c2hlZCkgewogICAgICAgICAgY29uc29sZS5sb2coIk5PVCBPUkRFUiBQVVNIRUQiKTsKICAgICAgICAgIG9yZGVyYm9vay5wdXNoKHsKICAgICAgICAgICAgaWQ6IGlucHV0VHJhbnNhY3Rpb24sCiAgICAgICAgICAgIHRyYW5zZmVyOiBpbnB1dFRyYW5zZmVyLAogICAgICAgICAgICBjcmVhdG9yOiBpbnB1dENyZWF0b3IsCiAgICAgICAgICAgIHRva2VuOiBpbnB1dFRva2VuLAogICAgICAgICAgICBwcmljZTogY29udmVydGVkRXhpc3RpbmdQcmljZSwKICAgICAgICAgICAgcXVhbnRpdHk6IGlucHV0UXVhbnRpdHkgLSBvcmRlcmJvb2tbaV0ucXVhbnRpdHkgKiBjb252ZXJ0ZWRFeGlzdGluZ1ByaWNlLAogICAgICAgICAgICBvcmlnaW5hbFF1YW50aXR5OiBpbnB1dFF1YW50aXR5CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3Qgb3JkZXIgPSBvcmRlcmJvb2suZmluZCgob3JkZXIyKSA9PiBvcmRlcjIuaWQgPT09IGlucHV0VHJhbnNhY3Rpb24pOwogICAgICAgICAgY29uc29sZS5sb2cob3JkZXIucXVhbnRpdHkgLSBvcmRlcmJvb2tbaV0ucXVhbnRpdHkgKiBjb252ZXJ0ZWRFeGlzdGluZ1ByaWNlKTsKICAgICAgICAgIG9yZGVyLnF1YW50aXR5IC09IG9yZGVyYm9va1tpXS5xdWFudGl0eSAqIGNvbnZlcnRlZEV4aXN0aW5nUHJpY2U7CiAgICAgICAgfQogICAgICAgIG9yZGVyYm9vayA9IG9yZGVyYm9vay5maWx0ZXIoKG9yZGVyKSA9PiBvcmRlci5pZCAhPT0gb3JkZXJib29rW2ldLmlkKTsKICAgICAgICBjb25zb2xlLmxvZygiNykgQ2FsbGluZyByZWN1cnNpdmVseSIpOwogICAgICAgIHJldHVybiBtYXRjaE9yZGVyKGlucHV0VG9rZW4sIGlucHV0UXVhbnRpdHksIGlucHV0Q3JlYXRvciwgaW5wdXRUcmFuc2FjdGlvbiwgaW5wdXRUcmFuc2Zlciwgb3JkZXJib29rLCBjb252ZXJ0ZWRFeGlzdGluZ1ByaWNlLCBmb3JlaWduQ2FsbHMsIGxvZ3MpOwogICAgICB9CiAgICB9CiAgfQogIGlmIChvcmRlclB1c2hlZCkgewogICAgcmV0dXJuIHsKICAgICAgb3JkZXJib29rLAogICAgICBmb3JlaWduQ2FsbHMsCiAgICAgIGxvZ3MKICAgIH07CiAgfQogIHJldHVybiB7CiAgICBvcmRlcmJvb2s6IFsKICAgICAgLi4ub3JkZXJib29rLAogICAgICB7CiAgICAgICAgaWQ6IGlucHV0VHJhbnNhY3Rpb24sCiAgICAgICAgdHJhbnNmZXI6IGlucHV0VHJhbnNmZXIsCiAgICAgICAgY3JlYXRvcjogaW5wdXRDcmVhdG9yLAogICAgICAgIHRva2VuOiBpbnB1dFRva2VuLAogICAgICAgIHByaWNlOiBpbnB1dFByaWNlLAogICAgICAgIHF1YW50aXR5OiBpbnB1dFF1YW50aXR5LAogICAgICAgIG9yaWdpbmFsUXVhbnRpdHk6IGlucHV0UXVhbnRpdHkKICAgICAgfQogICAgXSwKICAgIGZvcmVpZ25DYWxscywKICAgIGxvZ3MKICB9Owp9CgovLyBzcmMvY2xvYi9tb2R1bGVzL2NhbmNlbE9yZGVyLnRzCnZhciBDYW5jZWxPcmRlciA9IGFzeW5jIChzdGF0ZSwgYWN0aW9uKSA9PiB7CiAgY29uc3QgY2FsbGVyID0gYWN0aW9uLmNhbGxlcjsKICBjb25zdCBpbnB1dCA9IGFjdGlvbi5pbnB1dDsKICBjb25zdCBvcmRlclR4SUQgPSBpbnB1dC5vcmRlcklEOwogIENvbnRyYWN0QXNzZXJ0KGlzQWRkcmVzcyhvcmRlclR4SUQpLCAiSW52YWxpZCBvcmRlciBJRCIpOwogIGNvbnN0IGFsbE9yZGVycyA9IHN0YXRlLnBhaXJzLm1hcCgocGFpcikgPT4gcGFpci5vcmRlcnMpLmZsYXQoMSk7CiAgY29uc3Qgb3JkZXIgPSBhbGxPcmRlcnMuZmluZCgoe2lkfSkgPT4gaWQgPT09IG9yZGVyVHhJRCk7CiAgQ29udHJhY3RBc3NlcnQob3JkZXIgIT09IHZvaWQgMCwgIk9yZGVyIGRvZXMgbm90IGV4aXN0Iik7CiAgQ29udHJhY3RBc3NlcnQob3JkZXIuY3JlYXRvciA9PT0gY2FsbGVyLCAiQ2FsbGVyIGlzIG5vdCB0aGUgY3JlYXRvciBvZiB0aGUgb3JkZXIiKTsKICBzdGF0ZS5mb3JlaWduQ2FsbHMucHVzaCh7CiAgICB0eElEOiBTbWFydFdlYXZlLnRyYW5zYWN0aW9uLmlkLAogICAgY29udHJhY3Q6IG9yZGVyLnRva2VuLAogICAgaW5wdXQ6IHsKICAgICAgZnVuY3Rpb246ICJ0cmFuc2ZlciIsCiAgICAgIHRhcmdldDogY2FsbGVyLAogICAgICBxdHk6IG9yZGVyLnF1YW50aXR5CiAgICB9CiAgfSk7CiAgY29uc3QgYWNpdHZlUGFpciA9IHN0YXRlLnBhaXJzLmZpbmQoKHBhaXIpID0-IHBhaXIub3JkZXJzLmZpbmQoKHtpZH0pID0-IGlkID09PSBvcmRlclR4SUQpKTsKICBhY2l0dmVQYWlyLm9yZGVycyA9IGFjaXR2ZVBhaXIub3JkZXJzLmZpbHRlcigoe2lkfSkgPT4gaWQgIT09IG9yZGVyVHhJRCk7CiAgcmV0dXJuIHN0YXRlOwp9OwoKLy8gc3JjL2Nsb2IvbW9kdWxlcy9yZWFkT3V0Ym94LnRzCnZhciBSZWFkT3V0Ym94ID0gYXN5bmMgKHN0YXRlLCBhY3Rpb24pID0-IHsKICBjb25zdCBpbnB1dCA9IGFjdGlvbi5pbnB1dDsKICBDb250cmFjdEFzc2VydCghIWlucHV0LmNvbnRyYWN0LCAiTWlzc2luZyBjb250cmFjdCB0byBpbnZva2UiKTsKICBjb25zdCBmb3JlaWduU3RhdGUgPSBhd2FpdCBTbWFydFdlYXZlLmNvbnRyYWN0cy5yZWFkQ29udHJhY3RTdGF0ZShpbnB1dC5jb250cmFjdCk7CiAgQ29udHJhY3RBc3NlcnQoISFmb3JlaWduU3RhdGUuZm9yZWlnbkNhbGxzLCAiQ29udHJhY3QgaXMgbWlzc2luZyBzdXBwb3J0IGZvciBmb3JlaWduIGNhbGxzIik7CiAgY29uc3QgY2FsbHMgPSBmb3JlaWduU3RhdGUuZm9yZWlnbkNhbGxzLmZpbHRlcigoZWxlbWVudCkgPT4gZWxlbWVudC5jb250cmFjdCA9PT0gU21hcnRXZWF2ZS5jb250cmFjdC5pZCAmJiAhc3RhdGUuaW52b2NhdGlvbnMuaW5jbHVkZXMoZWxlbWVudC50eElEKSk7CiAgbGV0IHJlcyA9IHN0YXRlOwogIGZvciAoY29uc3QgZW50cnkgb2YgY2FsbHMpIHsKICAgIHJlcyA9IChhd2FpdCBoYW5kbGUocmVzLCB7Y2FsbGVyOiBpbnB1dC5jb250cmFjdCwgaW5wdXQ6IGVudHJ5LmlucHV0fSkpLnN0YXRlOwogICAgcmVzLmludm9jYXRpb25zLnB1c2goZW50cnkudHhJRCk7CiAgfQogIHJldHVybiByZXM7Cn07CgovLyBzcmMvY2xvYi9tb2R1bGVzL2FkZFBhaXIudHMKdmFyIEFkZFBhaXIgPSBhc3luYyAoc3RhdGUsIGFjdGlvbikgPT4gewogIGNvbnN0IGNhbGxlciA9IGFjdGlvbi5jYWxsZXI7CiAgY29uc3QgaW5wdXQgPSBhY3Rpb24uaW5wdXQ7CiAgY29uc3QgcGFpcnMgPSBzdGF0ZS5wYWlyczsKICBjb25zdCBjb21tdW5pdHlDb250cmFjdCA9IHN0YXRlLmNvbW11bml0eUNvbnRyYWN0OwogIGNvbnN0IGdhdGVrZWVwZXJBY3RpdmUgPSBzdGF0ZS5wYWlyR2F0ZWtlZXBlcjsKICBjb25zdCBuZXdQYWlyID0gaW5wdXQucGFpcjsKICBDb250cmFjdEFzc2VydChuZXdQYWlyLmxlbmd0aCA9PT0gMiwgIkludmFsaWQgcGFpciBsZW5ndGguIFNob3VsZCBiZSAyIik7CiAgQ29udHJhY3RBc3NlcnQoL1thLXowLTlfLV17NDN9L2kudGVzdChuZXdQYWlyWzBdKSAmJiAvW2EtejAtOV8tXXs0M30vaS50ZXN0KG5ld1BhaXJbMV0pLCAiT25lIG9mIHR3byBzdXBwbGllZCBwYWlycyBpcyBpbnZhbGlkIik7CiAgY29uc3QgY29tbXVuaXR5U3RhdGUgPSBhd2FpdCBTbWFydFdlYXZlLmNvbnRyYWN0cy5yZWFkQ29udHJhY3RTdGF0ZShjb21tdW5pdHlDb250cmFjdCk7CiAgQ29udHJhY3RBc3NlcnQoISFjb21tdW5pdHlTdGF0ZS50b2tlbnMuZmluZCgoe2lkfSkgPT4gaWQgPT09IG5ld1BhaXJbMF0pLCBgJHtuZXdQYWlyWzBdfSBpcyBub3QgbGlzdGVkIG9uIFZlcnRvYCk7CiAgQ29udHJhY3RBc3NlcnQoISFjb21tdW5pdHlTdGF0ZS50b2tlbnMuZmluZCgoe2lkfSkgPT4gaWQgPT09IG5ld1BhaXJbMV0pLCBgJHtuZXdQYWlyWzFdfSBpcyBub3QgbGlzdGVkIG9uIFZlcnRvYCk7CiAgaWYgKGdhdGVrZWVwZXJBY3RpdmUpIHsKICAgIENvbnRyYWN0QXNzZXJ0KCEhY29tbXVuaXR5U3RhdGUucGVvcGxlLmZpbmQoKHBlcnNvbikgPT4gcGVyc29uLmFkZHJlc3Nlcy5pbmNsdWRlcyhjYWxsZXIpKSwgIk5vIFZlcnRvIElEIGxpbmtlZCB0byB0aGlzIGFkZHJlc3MiKTsKICB9CiAgZm9yIChjb25zdCBpZCBvZiBuZXdQYWlyKSB7CiAgICB0cnkgewogICAgICBjb25zdCB0b2tlblN0YXRlID0gYXdhaXQgU21hcnRXZWF2ZS5jb250cmFjdHMucmVhZENvbnRyYWN0U3RhdGUoaWQpOwogICAgICBDb250cmFjdEFzc2VydCh0b2tlblN0YXRlPy50aWNrZXIgJiYgdG9rZW5TdGF0ZT8uYmFsYW5jZXMsICJDb250cmFjdCBpcyBub3QgYSB2YWxpZCB0b2tlbiIpOwogICAgICBDb250cmFjdEFzc2VydCh0eXBlb2YgdG9rZW5TdGF0ZS50aWNrZXIgPT09ICJzdHJpbmciLCAiQ29udHJhY3QgdGlja2VyIGlzIG5vdCBhIHN0cmluZyIpOwogICAgICBmb3IgKGNvbnN0IGFkZHIgaW4gdG9rZW5TdGF0ZS5iYWxhbmNlcykgewogICAgICAgIENvbnRyYWN0QXNzZXJ0KHR5cGVvZiB0b2tlblN0YXRlLmJhbGFuY2VzW2FkZHJdID09PSAibnVtYmVyIiwgYEludmFsaWQgYmFsYW5jZSBmb3IgIiR7YWRkcn0iIGluIGNvbnRyYWN0ICIke2lkfSJgKTsKICAgICAgfQogICAgICBjb25zdCB0cmFkZWFibGVTZXR0aW5nID0gdG9rZW5TdGF0ZT8uc2V0dGluZ3M_LmZpbmQoKFtzZXR0aW5nTmFtZV0pID0-IHNldHRpbmdOYW1lID09PSAiaXNUcmFkZWFibGUiKT8uWzFdOwogICAgICBDb250cmFjdEFzc2VydCh0cmFkZWFibGVTZXR0aW5nID09PSB0cnVlIHx8IHRyYWRlYWJsZVNldHRpbmcgPT09IHZvaWQgMCwgYFRoaXMgdG9rZW4gZG9lcyBub3QgYWxsb3cgdHJhZGluZyAoJHtpZH0pYCk7CiAgICAgIENvbnRyYWN0QXNzZXJ0KCEhdG9rZW5TdGF0ZS5pbnZvY2F0aW9ucywgJ0NvbnRyYWN0IGRvZXMgbm90IGhhdmUgYW4gImludm9jYXRpb25zIiBmaWxlZCwgbWFraW5nIGl0IGluY29tcGF0aWJsZSB3aXRoIEZDUCcpOwogICAgICBDb250cmFjdEFzc2VydCghIXRva2VuU3RhdGUuZm9yZWlnbkNhbGxzLCAnQ29udHJhY3QgZG9lcyBub3QgaGF2ZSBhbiAiZm9yZWlnbkNhbGxzIiBmaWxlZCwgbWFraW5nIGl0IGluY29tcGF0aWJsZSB3aXRoIEZDUCcpOwogICAgfSBjYXRjaCAoZSkgewogICAgICB0aHJvdyBuZXcgQ29udHJhY3RFcnJvcihlKTsKICAgIH0KICB9CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYWlycy5sZW5ndGg7IGkrKykgewogICAgY29uc3QgY3VycmVudFBhaXIgPSBwYWlyc1tpXS5wYWlyOwogICAgQ29udHJhY3RBc3NlcnQoIWN1cnJlbnRQYWlyLmluY2x1ZGVzKG5ld1BhaXJbMF0pICYmICFjdXJyZW50UGFpci5pbmNsdWRlcyhuZXdQYWlyWzFdKSwgIlRoaXMgcGFpciBhbHJlYWR5IGV4aXN0cyIpOwogIH0KICBzdGF0ZS5wYWlycy5wdXNoKHsKICAgIHBhaXI6IG5ld1BhaXIsCiAgICBwcmljZUxvZ3M6IG51bGwsCiAgICBvcmRlcnM6IFtdCiAgfSk7CiAgcmV0dXJuIHN0YXRlOwp9OwoKLy8gc3JjL2Nsb2IvbW9kdWxlcy9pbnZva2UudHMKdmFyIEludm9rZSA9IGFzeW5jIChzdGF0ZSwgYWN0aW9uKSA9PiB7CiAgY29uc3QgaW5wdXQgPSBhY3Rpb24uaW5wdXQ7CiAgQ29udHJhY3RBc3NlcnQoISFpbnB1dC5pbnZvY2F0aW9uLCAiTWlzc2luZyBmdW5jdGlvbiBpbnZvY2F0aW9uIik7CiAgQ29udHJhY3RBc3NlcnQoISFpbnB1dC5mb3JlaWduQ29udHJhY3QsICJNaXNzaW5nIGZvcmVpZ24gY29udHJhY3QgSUQiKTsKICBzdGF0ZS5mb3JlaWduQ2FsbHMucHVzaCh7CiAgICB0eElEOiBTbWFydFdlYXZlLnRyYW5zYWN0aW9uLmlkLAogICAgY29udHJhY3Q6IGlucHV0LmZvcmVpZ25Db250cmFjdCwKICAgIGlucHV0OiBpbnB1dC5pbnZvY2F0aW9uCiAgfSk7CiAgcmV0dXJuIHN0YXRlOwp9OwoKLy8gc3JjL2Nsb2IvbW9kdWxlcy9oYWx0LnRzCnZhciBIYWx0ID0gKHN0YXRlLCBhY3Rpb24pID0-IHsKICBjb25zdCBjYWxsZXIgPSBhY3Rpb24uY2FsbGVyOwogIENvbnRyYWN0QXNzZXJ0KGNhbGxlciA9PT0gc3RhdGUuZW1lcmdlbmN5SGFsdFdhbGxldCwgIkNhbGxlciBjYW5ub3QgaGFsdCBvciByZXN1bWUgdGhlIHByb3RvY29sIik7CiAgcmV0dXJuIHsuLi5zdGF0ZSwgaGFsdGVkOiAhc3RhdGUuaGFsdGVkfTsKfTsKCi8vIHNyYy9jbG9iL2luZGV4LnRzCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGUoc3RhdGUsIGFjdGlvbikgewogIENvbnRyYWN0QXNzZXJ0KCFzdGF0ZS5oYWx0ZWQgfHwgYWN0aW9uLmlucHV0LmZ1bmN0aW9uID09PSAiaGFsdCIsICJUaGUgY29udHJhY3QgaXMgY3VycmVudGx5IGhhbHRlZCIpOwogIHN3aXRjaCAoYWN0aW9uLmlucHV0LmZ1bmN0aW9uKSB7CiAgICBjYXNlICJhZGRQYWlyIjoKICAgICAgcmV0dXJuIHtzdGF0ZTogYXdhaXQgQWRkUGFpcihzdGF0ZSwgYWN0aW9uKX07CiAgICBjYXNlICJjcmVhdGVPcmRlciI6CiAgICAgIHJldHVybiB7c3RhdGU6IGF3YWl0IENyZWF0ZU9yZGVyKHN0YXRlLCBhY3Rpb24pfTsKICAgIGNhc2UgImNhbmNlbE9yZGVyIjoKICAgICAgcmV0dXJuIHtzdGF0ZTogYXdhaXQgQ2FuY2VsT3JkZXIoc3RhdGUsIGFjdGlvbil9OwogICAgY2FzZSAicmVhZE91dGJveCI6CiAgICAgIHJldHVybiB7c3RhdGU6IGF3YWl0IFJlYWRPdXRib3goc3RhdGUsIGFjdGlvbil9OwogICAgY2FzZSAiaW52b2tlIjoKICAgICAgcmV0dXJuIHtzdGF0ZTogYXdhaXQgSW52b2tlKHN0YXRlLCBhY3Rpb24pfTsKICAgIGNhc2UgInRvZ2dsZVBhaXJHYXRla2VlcGVyIjoKICAgICAgcmV0dXJuIHtzdGF0ZTogVG9nZ2xlUGFpckdhdGVrZWVwZXIoc3RhdGUsIGFjdGlvbil9OwogICAgY2FzZSAic2V0Q29tbXVuaXR5Q29udHJhY3QiOgogICAgICByZXR1cm4ge3N0YXRlOiBTZXRDb21tdW5pdHlDb250cmFjdChzdGF0ZSwgYWN0aW9uKX07CiAgICBjYXNlICJmb3JlaWduVHJhbnNmZXIiOgogICAgICByZXR1cm4ge3N0YXRlOiBGb3JlaWduVHJhbnNmZXIoc3RhdGUsIGFjdGlvbil9OwogICAgY2FzZSAiaGFsdCI6CiAgICAgIHJldHVybiB7c3RhdGU6IEhhbHQoc3RhdGUsIGFjdGlvbil9OwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IENvbnRyYWN0RXJyb3IoYEludmFsaWQgZnVuY3Rpb246ICIke2FjdGlvbi5pbnB1dC5mdW5jdGlvbn0iYCk7CiAgfQp9Cg